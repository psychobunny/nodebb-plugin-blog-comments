!function(){"use strict";function k(){try{return l=new XMLHttpRequest}catch(a){try{return l=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return l=new ActiveXObject("Msxml2.XMLHTTP")}}}function o(a){c=e.value,n=window.open(nodeBBURL+"/"+a+"/#blog/authenticate","_blank","toolbar=no, scrollbars=no, resizable=no, width=600, height=675");var b=setInterval(function(){n.closed&&(clearInterval(b),m=0,q())},500)}function p(a){return a.replace(/href="\/(?=\w)/g,'href="'+nodeBBURL+"/").replace(/src="\/(?=\w)/g,'src="'+nodeBBURL+"/")}function q(){l.open("GET",nodeBBURL+"/comments/get/"+articleID+"/"+m,!0),l.withCredentials=!0,l.send()}function r(a){var b=[[60,"seconds",1],[120,"1 minute ago"],[3600,"minutes",60],[7200,"1 hour ago"],[86400,"hours",3600],[172800,"yesterday"],[604800,"days",86400],[1209600,"last week"],[2419200,"weeks",604800],[4838400,"last month"],[29030400,"months",2419200],[58060800,"last year"],[290304e4,"years",29030400]],c=(+new Date-a)/1e3;if(10>c)return"just now";for(var e,d=0;e=b[d++];)if(c<e[0])return e[2]?Math.floor(c/e[2])+" "+e[1]+" ago":e[1];return a}function t(a,b){function c(a,b,c){var d=new RegExp("{"+a+"}","g");return c.replace(d,b)}function d(a){return new RegExp("<!--[\\s]*BEGIN "+a+"[\\s]*-->[\\s\\S]*<!--[\\s]*END "+a+"[\\s]*-->","g")}function e(a){return new RegExp("<!--[\\s]*IF "+a+"[\\s]*-->([\\s\\S]*?)<!--[\\s]*ENDIF "+a+"[\\s]*-->","g")}function f(a,b,c){if(f=c.match(a),null!=f){void 0!==b&&(s.blocks[b]=f[0]);var d=new RegExp("(\r\n)*<!-- BEGIN "+b+" -->(\r\n)*","g"),e=new RegExp("(\r\n)*<!-- END "+b+" -->(\r\n)*","g"),f=f[0].replace(d,"").replace(e,"");return f}}function g(a,b,c){return c.replace(a,b)}return function j(a,b,h,i){function k(a,b){var c=e(a),d=h.match(c);if(null!==d)for(var f=0,g=d.length;g>f;f++){var i=d[f].split(/<!-- ELSE -->/),j=new RegExp("(<!--[\\s]*IF "+a+"[\\s]*-->)|(<!--[\\s]*ENDIF "+a+"[\\s]*-->)","gi");h=i[1]?b?h.replace(d[f],i[0].replace(j,"")):h.replace(d[f],i[1].replace(j,"")):b?h.replace(d[f],d[f].replace(j,"")):h.replace(d[f],"")}}a&&0!=a.length||(h="");for(var l in a)if(a.hasOwnProperty(l)){if("undefined"==typeof a[l])continue;if(null===a[l])h=c(b+l,"",h);else if(a[l].constructor==Array){k(b+l+".length",a[l].length),k("!"+b+l+".length",!a[l].length),b+=l+".";var m=d(l),n=f(m,b.substring(0,b.length-1),h);if(null==n){b=b.replace(l+".","");continue}var o=a[l].length-1,p=0,q="";do q+=j(a[l][p],b,n,{iterator:p,total:o});while(p++<o);b=b.replace(l+".",""),h=g(m,q,h)}else if(a[l]instanceof Object)h=j(a[l],l+".",h);else{var r=b+l,s="string"==typeof a[l]?a[l].replace(/^\s+|\s+$/g,""):a[l];k(r,s),k("!"+r,!s),i&&i.iterator&&(k("@first",0===i.iterator),k("!@first",0!==i.iterator),k("@last",i.iterator===i.total),k("!@last",i.iterator!==i.total)),h=c(r,s,h)}}if(b){var m=new RegExp("{"+b+"[\\s\\S]*?}","g");h=h.replace(m,""),b=""}else h=h.replace(/<!-- ELSE -->/gi,"ENDIF -->").replace(/<!-- IF([^@]*?)ENDIF([^@]*?)-->/gi,"");return h}(a,"",b)}var c,d,e,f,g,h,i,a=window.location.protocol+"//"+window.location.host+window.location.pathname,b=nodeBBURL+"/plugins/nodebb-plugin-blog-comments",j=document.createElement("link");j.setAttribute("rel","stylesheet"),j.setAttribute("type","text/css"),j.setAttribute("href",b+"/css/comments.css"),document.getElementsByTagName("head")[0].appendChild(j),document.getElementById("nodebb/comments").insertAdjacentHTML("beforebegin",'<div id="nodebb"></div>'),d=document.getElementById("nodebb");var n,l=k(),m=0;l.onload=function(){if(l.status>=200&&l.status<400){var j,b=JSON.parse(l.responseText);f=document.getElementById("nodebb-comments-list"),g=document.getElementById("nodebb-comments-count"),h=document.getElementById("nodebb-comments-author"),i=document.getElementById("nodebb-comments-category"),b.relative_path=nodeBBURL,b.redirect_url=a,b.article_id=articleID,b.pagination=m,b.postCount=parseInt(b.postCount,10);for(var n in b.posts)b.posts.hasOwnProperty(n)&&(b.posts[n].timestamp=r(parseInt(b.posts[n].timestamp),10),b.posts[n]["blog-comments:url"]&&delete b.posts[n]);if(g&&(g.innerHTML=b.postCount?b.postCount-1:0),i&&b.category&&(i.innerHTML='<a href="'+nodeBBURL+"/category/"+b.category.slug+'">'+b.category.name+"</a>"),h&&b.mainPost&&(h.innerHTML='<span class="nodebb-author"><img src="'+b.mainPost.user.picture+'" /> <a href="'+nodeBBURL+"/user/"+b.mainPost.user.userslug+'">'+b.mainPost.user.username+"</a></span>"),m?(j=p(t(b,s.blocks.posts)),f.innerHTML=f.innerHTML+j):(j=t(b,b.template),d.innerHTML=p(j)),e=document.getElementById("nodebb-content"),setTimeout(function(){var a=d.getElementsByTagName("li");for(var b in a)a.hasOwnProperty(b)&&(a[b].className="")},100),c&&(e.value=c),b.tid){var u=document.getElementById("nodebb-load-more");if(u.onclick=function(){m++,q()},b.posts.length&&(u.style.display="inline-block"),10*m+b.posts.length+1>=b.postCount&&(u.style.display="none"),"undefined"!=typeof jQuery&&jQuery()&&jQuery().fitVids&&jQuery(d).fitVids(),b.user&&b.user.uid){var v=window.location.href.match(/error=[\w-]*/);v&&(v=v[0].split("=")[1],"too-many-posts"===v?v="Please wait before posting so soon.":"content-too-short"===v&&(v="Please post a longer reply."),document.getElementById("nodebb-error").innerHTML=v)}else document.getElementById("nodebb-register").onclick=function(){o("register")},document.getElementById("nodebb-login").onclick=function(){o("login")}}else if(b.isAdmin){var w=k();w.open("GET","/ghost/api/v0.1/posts/"+articleID),w.onload=function(){if(w.status>=200&&w.status<400){var c=JSON.parse(w.responseText).posts[0],e=c.markdown.split("\n\n").slice(0,2).join("\n\n")+"\n\n**Click [here]("+a+") to see the full blog post**";document.getElementById("nodebb-content-markdown").value=e,document.getElementById("nodebb-content-title").value=c.title}else d.innerHTML="Welcome "+b.user.username+', <a href="/ghost">sign in to Ghost</a> to enable the publish button.</a>'},w.send()}}},q();var s={blocks:{}}}();